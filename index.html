<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Рейси</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 480px; margin: 10px auto; padding: 0 10px; }
    h1 { text-align: center; }
    form { background: #f3f3f3; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input[type="text"] { width: 100%; padding: 8px; margin-top: 5px; box-sizing: border-box; border-radius: 4px; border: 1px solid #ccc; }
    button { margin-top: 15px; padding: 10px; width: 100%; border: none; background: #007bff; color: white; font-size: 16px; border-radius: 5px; cursor: pointer; }
    button:hover { background: #0056b3; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #eee; }
    .actions button { margin-right: 5px; padding: 5px 10px; font-size: 0.9rem; cursor: pointer; }
    .actions button.delete { background: #e74c3c; color: white; border: none; border-radius: 3px; }
    .actions button.edit { background: #28a745; color: white; border: none; border-radius: 3px; }
  </style>
</head>
<body>
  <h1>Рейси</h1>

  <form id="tripForm">
    <input type="hidden" id="editIndex" />
    <label for="tripName">Назва рейсу *</label>
    <input type="text" id="tripName" required placeholder="Введіть назву рейсу" />
    <button type="submit">Додати / Оновити рейс</button>
  </form>

  <table aria-label="Список рейсів" id="tripTable">
    <thead>
      <tr>
        <th>Назва рейсу</th>
        <th>Дата створення</th>
        <th>Дії</th>
      </tr>
    </thead>
    <tbody id="tripList"></tbody>
  </table>

  <script>
    let trips = JSON.parse(localStorage.getItem('trips') || '[]');

    const tripForm = document.getElementById('tripForm');
    const tripList = document.getElementById('tripList');
    const tripNameInput = document.getElementById('tripName');
    const editIndexInput = document.getElementById('editIndex');

    function saveTrips() {
      localStorage.setItem('trips', JSON.stringify(trips));
    }

    function renderTrips() {
      tripList.innerHTML = '';
      if (trips.length === 0) {
        tripList.innerHTML = '<tr><td colspan="3" style="text-align:center;">Рейсів ще немає</td></tr>';
        return;
      }
      trips.forEach((trip, i) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${trip.name}</td>
          <td>${new Date(trip.createdAt).toLocaleString()}</td>
          <td class="actions">
            <button class="edit" data-index="${i}">Редагувати</button>
            <button class="delete" data-index="${i}">Видалити</button>
            <button class="open" data-index="${i}">Відкрити</button>
          </td>
        `;
        tripList.appendChild(tr);
      });
    }

    tripForm.addEventListener('submit', e => {
      e.preventDefault();
      const name = tripNameInput.value.trim();
      if (!name) return alert('Введіть назву рейсу!');

      const editIndex = editIndexInput.value;

      if(editIndex === '') {
        trips.push({ name, createdAt: new Date().toISOString() });
      } else {
        trips[editIndex].name = name;
      }
      saveTrips();
      renderTrips();
      tripForm.reset();
      editIndexInput.value = '';
    });

    tripList.addEventListener('click', e => {
      if(e.target.tagName !== 'BUTTON') return;
      const idx = e.target.dataset.index;

      if(e.target.classList.contains('delete')) {
        if(confirm('Видалити рейс? Всі посилки в ньому також будуть видалені.')) {
          trips.splice(idx, 1);
          saveTrips();

          // Видалити посилки цього рейсу
          let parcels = JSON.parse(localStorage.getItem('parcels') || '[]');
          parcels = parcels.filter(p => p.tripId !== idx);
          localStorage.setItem('parcels', JSON.stringify(parcels));

          renderTrips();
        }
      } else if(e.target.classList.contains('edit')) {
        tripNameInput.value = trips[idx].name;
        editIndexInput.value = idx;
      } else if(e.target.classList.contains('open')) {
        // Переходимо на сторінку посилок з id рейсу
        window.location.href = `trip.html?tripId=${idx}`;
      }
    });

    renderTrips();
  </script>
</body>
</html>
